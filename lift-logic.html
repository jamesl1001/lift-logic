<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<meta name="description" content="Emulate the logic of a lift."/>
	<meta name="author" content="James Alexander Lee"/>
	<title>Lift Logic</title>
</head>
<body>
	<h1>Lift Logic</h1>
	<a href="https://github.com/jamesl1001/lift-logic" target="_blank">https://github.com/jamesl1001/lift-logic</a>
	<p>Fed up with the lifts at work, I wanted to see how difficult it is to programme the logic of a lift.</p>
	<p>Open console</p>

	<hr>

	<p>Current floor: <span id="currentFloor"></span></p>

	<button class="liftButton">1</button>
	<button class="liftButton">2</button>
	<button class="liftButton">3</button>
	<button class="liftButton">4</button>
	<button class="liftButton">5</button>
	<button class="liftButton">6</button>
	<button class="liftButton">7</button>
	<button class="liftButton">8</button>
	<button class="liftButton">9</button>
	<button class="liftButton">10</button>

	<script>
		function Lift(currentFloor, requests, waitTimeout) {
			self = this;

			// Lift properties
			self.direction        = 'stationary';	// stationary/up/down
			self.currentFloor     = currentFloor;
			self.destinationFloor = null;
			// self.requests         = requests;	// array of floor requests (inside/outside)
			self.speed            = 1000;
			self.waitTimeout      = waitTimeout;	// time to wait before returning to floor 1
		}

		Lift.prototype.getLiftStatus = function() {
			console.log('---GET LIFT STATUS---');
			console.log('Direction: ' + self.direction);
			// console.log('Requests: ' + self.requests);
			console.log('Wait timeout: ' + self.waitTimeout);
			console.log('Current floor: ' + self.currentFloor);
			console.log('Destination floor: ' + self.destinationFloor);

			var currentFloorLabel = document.getElementById('currentFloor');
			currentFloorLabel.innerHTML = self.currentFloor;
		}

		Lift.prototype.pressButton = function(e) {
			self.destinationFloor = e.target.innerHTML;
			console.log('---BUTTON ' + self.destinationFloor + ' PRESSED---');
			// self.origin = origin;	// inside/outside
			// console.log('---BUTTON ' + floor + ' PRESSED FROM THE ' + origin + '---');

			self.moveLift();
		}

		Lift.prototype.moveLift = function() {
			console.log('MOVING LIFT TO FLOOR: ' + self.destinationFloor);

			self.getDirection();

			var timer = setInterval(function() {
				if(self.direction == 'stationary') {
					clearInterval(timer);
					console.log('---LIFT ARRIVED---');
					self.getLiftStatus();
					self.liftWaiting();
				} else {
					if(self.direction == 'up') {
						self.currentFloor++;
						console.log(self.currentFloor);
					} else if(self.direction == 'down') {
						self.currentFloor--;
						console.log(self.currentFloor);
					}
					self.getDirection();
					self.getLiftStatus();
				}
			}, self.speed);
		}

		Lift.prototype.getDirection = function() {
			if(self.destinationFloor == self.currentFloor) {
				self.direction = 'stationary';
			} else if(self.destinationFloor > self.currentFloor) {
				self.direction = 'up';
			} else if(self.destinationFloor < self.currentFloor) {
				self.direction = 'down';
			}
			console.log('---LIFT IS MOVING ' + self.direction + '---');
		}

		Lift.prototype.liftWaiting = function() {
			if(self.destinationFloor != 1) {
				setTimeout(function() {
					console.log('---WAIT TIMEOUT REACHED. LIFT RETURNING TO FLOOR 1---');
					self.destinationFloor = 1;
					self.moveLift();
				}, self.waitTimeout);
			}
		}



		console.log('---INITIALISE LIFT---');
		var lift1 = new Lift(1, [], 10000);
		lift1.getLiftStatus();

		var liftButtons = document.querySelectorAll('.liftButton');
		for(var i = 0; i < liftButtons.length; i++) {
			liftButtons[i].addEventListener("click", self.pressButton, false);
		}
	</script>
</body>
</html>